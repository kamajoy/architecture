## 架构中一些常见的理论

### 0x001、CAP
```doc
C 一致性：每次读取都会收到最近的写入或错误
A 可用性：每个请求都会收到（非错误）响应 - 不保证它包含最近的写入
P 分区容错：尽管节点之间的网络丢弃（或延迟）任意数量的消息，系统仍继续运行

ps: 最多只能同时满足两个，特别是，CAP定理意味着在存在网络分区时，必须在一致性和可用性之间进行选择。请注意，CAP定理中定义的一致性与ACID 数据库事务中保证的一致性完全不同。
```

`解释`
> 没有分布式系统可以避免网络故障，因此通常必须容忍网络分区。在存在分区的情况下，可以选择一个分区：一致性或可用性。在可用性选择一致性时，如果由于网络>  > 分区而无法保证特定信息是最新的，则系统将返回错误或超时。在选择可用性而非一致性时，系统将始终处理查询并尝试返回最新的可用信息版本，即使由于网络分区> > 而无法保证其是最新的。
> 在没有网络故障的情况下 - 也就是说，当分布式系统正常运行时 - 可以满足可用性和一致性。
> CAP经常被误解，好像必须始终选择放弃三种保证之一。实际上，只有在发生网络分区或故障时，才能在一致性和可用性之间做出选择; 在所有其他时间，不需要进行任> 何权衡。[4] [5]
> 使用传统ACID设计的数据库系统可以保证RDBMS选择一致性而非可用性，而基于BASE理念设计的系统（例如NoSQL运动中常见的）选择可用性而不是一致性。[6]
> 所述PACELC定理通过阐明，即使在不存在划分的，延迟和一致性之间的另一种折衷发生建立在CAP。

### 0x002、分布式锁

### 0x003、一致性hash

### 0x004、分布式事物

### 0x005、QPS
> * 每秒查询率QPS是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准(简单说就是能支持多少并发量);
> * Queries Per Second意思是“每秒查询率”，是一台服务器每秒能够相应的查询次数，是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准;
> * 并发数： 系统同时处理的request/事务数;
> * 响应时间：  一般取平均响应时间;
> * 公式：并发数/平均响应时间

### 0x006、TPS
> * TPS (transaction per second)代表每秒执行的事务数量，可基于测试周期内完成的事务数量计算得出;
> * 公式：每秒钟request/事务 数量;
> * 比如评论系统至少需要支持每秒写入100个评论，那么TPS至少需要大于100；
> * TPS (transaction per second)代表每秒执行的事务数量，可基于测试周期内完成的事务数量计算得出。例如，用户每分钟执行6个事务，TPS为6 / 60s = 0.10 TPS。同时我们会知道事务的响应时间(或节拍)，以此例，60秒完成6个事务也同时代表每个事务的响应时间或节拍为10秒。

### 0x007、PV
> * PV（page view）即页面浏览量，通常是衡量一个网络新闻频道或网站甚至一条网络新闻的主要指标。网页浏览数是评价网站流量最常用的指标之一，简称为PV。

### 0x008、qps、tps、pv计算
```doc 
术语说明：
QPS = req/sec = 请求数/秒

【QPS计算PV和机器的方式】

QPS统计方式 [一般使用 http_load 进行统计]
QPS = 总请求数 / ( 进程总数 * 请求时间 )
QPS: 单个进程每秒请求服务器的成功次数

单台服务器每天PV计算
公式1：每天总PV = QPS * 3600 * 6
公式2：每天总PV = QPS * 3600 * 8

服务器计算
服务器数量 = ceil( 每天总PV / 单台服务器每天总PV )

【峰值QPS和机器计算公式】

原理：每天80%的访问集中在20%的时间里，这20%时间叫做峰值时间
公式：( 总PV数 * 80% ) / ( 每天秒数 * 20% ) = 峰值时间每秒请求数(QPS)
机器：峰值时间每秒QPS / 单台机器的QPS = 需要的机器

问：每天300w PV 的在单台机器上，这台机器需要多少QPS？
答：( 3000000 * 0.8 ) / (86400 * 0.2 ) = 139 (QPS)

问：如果一台机器的QPS是58，需要几台机器来支持？
答：139 / 58 = 3

```

### 0x009 UV
> * UV是unique visitor的简写，是指通过互联网访问、浏览这个网页的自然人。独立IP：是指独立用户/独立访客。

### 0x0010 ACID
```doc
事务的特征：ACID
原子性Atomicity 一组DML语句要么全部成功要么全部失败
一致性Consistency 事务必须由一个状态到另一个状态
隔离性Isolation 多个事务之间能够根据事务的隔离级别表现不同
持久性Durability 提交后的事务，一旦提交，它对数据库中的数据修改是永久性的
```




